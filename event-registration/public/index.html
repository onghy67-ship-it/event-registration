<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registration Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .category-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 10px;
    }
    .category-science {
      background: #e3f2fd;
      color: #1565c0;
    }
    .category-business {
      background: #f3e5f5;
      color: #7b1fa2;
    }
    .category-selector {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    .category-btn {
      padding: 12px 30px;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
    }
    .category-btn:hover {
      border-color: #4a90d9;
    }
    .header.science-theme {
      background: linear-gradient(135deg, #004d40, #00897b);
    }
    .header.business-theme {
      background: linear-gradient(135deg, #4a148c, #7b1fa2);
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1.5fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 900px) {
      .stats-grid { grid-template-columns: 1fr 1fr; }
    }
    
    @media (max-width: 500px) {
      .stats-grid { grid-template-columns: 1fr; }
    }
    
    /* Top Courses Card */
    .top-courses-card {
      background: white;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .top-courses-card h4 {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .top-course-item {
      display: flex;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .top-course-item:last-child { border-bottom: none; }
    
    .top-course-rank {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #4a90d9;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      margin-right: 10px;
    }
    
    .top-course-rank.rank-1 { background: #ffd700; color: #333; }
    .top-course-rank.rank-2 { background: #c0c0c0; color: #333; }
    .top-course-rank.rank-3 { background: #cd7f32; color: white; }
    
    .top-course-name {
      flex: 1;
      font-size: 0.9rem;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .top-course-count {
      font-size: 1.1rem;
      font-weight: bold;
      color: #e67e22;
      margin-left: 10px;
    }
    
    .no-waiting {
      color: #999;
      font-style: italic;
      font-size: 0.9rem;
      padding: 10px 0;
    }
    
    /* Longest Queue Card */
    .longest-queue-card {
      background: white;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .longest-queue-card h4 {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 8px;
      text-transform: uppercase;
    }
    
    .longest-queue-count {
      font-size: 2.5rem;
      font-weight: bold;
      color: #e74c3c;
    }
    
    .longest-queue-name {
      font-size: 0.85rem;
      color: #333;
      margin-top: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Status Colors */
    tr.status-registered { background: #f8f9fa; }
    tr.status-waiting { background: #fff3cd; }
    tr.status-inside { background: #cce5ff; }
    tr.status-ended { background: #d4edda; }
    tr.status-urgent { background: #f8d7da; }
    tr.status-noanswer { background: #e2e3e5; }
    
    /* Password Modal */
    .password-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .password-overlay.hidden {
      display: none;
    }
    
    .password-box {
      background: white;
      padding: 40px;
      border-radius: 16px;
      text-align: center;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .password-box h2 {
      margin-bottom: 10px;
      color: #333;
    }
    
    .password-box p {
      color: #666;
      margin-bottom: 25px;
    }
    
    .password-input {
      width: 100%;
      padding: 15px;
      font-size: 1.1rem;
      border: 2px solid #ddd;
      border-radius: 10px;
      text-align: center;
      letter-spacing: 3px;
      margin-bottom: 15px;
    }
    
    .password-input:focus {
      outline: none;
      border-color: #4a90d9;
    }
    
    .password-input.error {
      border-color: #e74c3c;
      animation: shake 0.5s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-10px); }
      40%, 80% { transform: translateX(10px); }
    }
    
    .password-error {
      color: #e74c3c;
      font-size: 0.9rem;
      margin-bottom: 15px;
      display: none;
    }
    
    .password-error.show {
      display: block;
    }
    
    .password-submit {
      width: 100%;
      padding: 15px;
      font-size: 1.1rem;
      background: #4a90d9;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .password-submit:hover {
      background: #357abd;
    }
    
    .password-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  
  <!-- Password Protection Modal -->
  <div class="password-overlay" id="passwordOverlay">
    <div class="password-box">
      <div class="password-icon">ğŸ”</div>
      <h2>Staff Access Only</h2>
      <p>Enter password to access dashboard<br>è¯·è¾“å…¥å¯†ç ä»¥è®¿é—®ä»ªè¡¨æ¿</p>
      <input type="password" 
             class="password-input" 
             id="passwordInput" 
             placeholder="Password å¯†ç "
             onkeypress="if(event.key==='Enter')checkPassword()">
      <div class="password-error" id="passwordError">
        Incorrect password å¯†ç é”™è¯¯
      </div>
      <button class="password-submit" onclick="checkPassword()">
        Enter è¿›å…¥
      </button>
    </div>
  </div>

  <header class="header" id="header">
    <h1>
      <span id="eventName">Event Registration</span>
      <span class="category-badge" id="categoryBadge"></span>
    </h1>
    <p>Registration Dashboard ç™»è®°ä»ªè¡¨æ¿</p>
    <span class="status-badge" id="connectionStatus">ğŸŸ¢ Connected</span>
  </header>

  <main class="container">
    <!-- Category Selector -->
    <div class="category-selector" id="categorySelector" style="display: none;">
      <button class="category-btn" onclick="selectCategory('science')">
        ğŸ”¬ Science & IT<br>ç†å·¥ç§‘
      </button>
      <button class="category-btn" onclick="selectCategory('business')">
        ğŸ’¼ Business & Art<br>å•†ç§‘
      </button>
    </div>

    <!-- Main Content -->
    <div id="mainContent" style="display: none;">
      <!-- Stats -->
      <section class="stats-grid">
        <!-- Top 3 Waiting Courses -->
        <div class="top-courses-card">
          <h4>ğŸ”¥ Top 3 Waiting çƒ­é—¨ç­‰å€™</h4>
          <div id="topCoursesContent">
            <div class="no-waiting">No one waiting æš‚æ— ç­‰å€™</div>
          </div>
        </div>
        
        <!-- Waiting Count -->
        <div class="stat-card waiting">
          <div class="stat-number" id="waitingCount">0</div>
          <div class="stat-label">Waiting ç­‰å€™</div>
        </div>
        
        <!-- Inside Count -->
        <div class="stat-card inside">
          <div class="stat-number" id="insideCount">0</div>
          <div class="stat-label">Inside è¿›è¡Œä¸­</div>
        </div>
        
        <!-- Longest Queue -->
        <div class="longest-queue-card">
          <h4>â³ Longest Queue æœ€é•¿é˜Ÿä¼</h4>
          <div class="longest-queue-count" id="longestQueueCount">0</div>
          <div class="longest-queue-name" id="longestQueueName">-</div>
        </div>
      </section>

      <!-- QR Code -->
      <section class="card qr-section">
        <h3>ğŸ“± <span id="qrTitle">Scan to Register</span></h3>
        <div class="qr-content">
          <div class="qr-box">
            <img id="qrCodeImage" src="" alt="QR Code">
          </div>
          <div class="qr-info">
            <p><strong>Registration URL:</strong></p>
            <code id="registrationUrl"></code>
            <div class="qr-actions">
              <button class="btn btn-outline" onclick="copyUrl()">ğŸ“‹ Copy</button>
              <button class="btn btn-outline" onclick="printQR()">ğŸ–¨ï¸ Print</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Table -->
      <section class="card table-section">
        <div class="table-header">
          <input type="text" id="searchInput" class="search-input" placeholder="ğŸ” Search...">
          <div class="table-actions">
            <button class="btn" onclick="switchCategory()">ğŸ”„ Switch</button>
            <button class="btn" onclick="refreshData()">ğŸ”„ Refresh</button>
            <button class="btn btn-primary" onclick="exportCSV()">ğŸ“¥ Export</button>
            <a href="/admin.html" class="btn">âš™ï¸ Admin</a>
            <button class="btn" onclick="logout()" title="Logout">ğŸšª</button>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Time æ—¶é—´</th>
                <th>Name å§“å</th>
                <th>Phone ç”µè¯</th>
                <th>Programme è¯¾ç¨‹</th>
                <th>Status çŠ¶æ€</th>
                <th>Remark å¤‡æ³¨</th>
                <th>Time In</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>

        <div id="emptyState" class="empty-state">
          <span class="empty-icon">ğŸ“‹</span>
          <p>No registrations yet<br>æš‚æ— ç™»è®°</p>
        </div>

        <div id="loadingState" class="loading-state">
          <div class="spinner"></div>
        </div>
      </section>
    </div>
  </main>

  <!-- Delete Modal -->
  <div class="modal-backdrop" id="deleteModal">
    <div class="modal">
      <h3>Delete Registration?</h3>
      <p>This action cannot be undone.</p>
      <div class="modal-buttons">
        <button class="btn" onclick="closeModal()">Cancel</button>
        <button class="btn btn-danger" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>
