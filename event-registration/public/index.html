<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registration Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .category-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 10px;
    }
    .category-science { background: #e3f2fd; color: #1565c0; }
    .category-business { background: #f3e5f5; color: #7b1fa2; }
    
    .category-selector {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    .category-btn {
      padding: 15px 40px;
      border: 2px solid #ddd;
      border-radius: 12px;
      background: white;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
    }
    .category-btn:hover { border-color: #4a90d9; transform: translateY(-2px); }
    
    .header.science-theme { background: linear-gradient(135deg, #004d40, #00897b); }
    .header.business-theme { background: linear-gradient(135deg, #4a148c, #7b1fa2); }
    
    /* Stats Grid - 4 columns */
    .stats-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1.5fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 900px) { .stats-grid { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 500px) { .stats-grid { grid-template-columns: 1fr; } }
    
    /* Top Courses Card */
    .top-courses-card {
      background: white;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .top-courses-card h4 {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 10px;
      text-transform: uppercase;
    }
    .top-course-item {
      display: flex;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }
    .top-course-item:last-child { border-bottom: none; }
    .top-course-rank {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
      margin-right: 8px;
    }
    .rank-1 { background: #ffd700; color: #333; }
    .rank-2 { background: #c0c0c0; color: #333; }
    .rank-3 { background: #cd7f32; color: white; }
    .top-course-name {
      flex: 1;
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .top-course-count {
      font-size: 1rem;
      font-weight: bold;
      color: #e67e22;
      margin-left: 8px;
    }
    .no-waiting { color: #999; font-style: italic; font-size: 0.9rem; padding: 10px 0; }
    
    /* Longest Wait Card */
    .longest-wait-card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    .longest-wait-card h4 {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 5px;
      text-transform: uppercase;
    }
    .longest-wait-number {
      font-size: 2rem;
      font-weight: bold;
      color: #e74c3c;
    }
    .longest-wait-course {
      font-size: 0.8rem;
      color: #333;
      margin-top: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .no-long-wait {
      color: #28a745;
      font-size: 0.9rem;
    }
    
    /* Updated Status Colors */
    tr.status-waiting { background: #fff3cd; }    /* Orange/Yellow */
    tr.status-consulting { background: #cce5ff; } /* Blue */
    tr.status-inside { background: #ffeeba; }     /* Yellow */
    tr.status-ended { background: #d4edda; }      /* Green */
    tr.status-urgent { background: #f8d7da; }     /* Red */
    tr.status-noanswer { background: #e2e3e5; }   /* Gray */
    
    /* Filter Dropdown */
    .filter-select {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 0.95rem;
      min-width: 250px;
      cursor: pointer;
    }
    .filter-select:focus { outline: none; border-color: #4a90d9; }
    
    /* Sync indicator */
    .sync-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .sync-indicator.syncing {
      background: #ffc107;
      animation: pulse 1s infinite;
    }
    .sync-indicator.synced { background: #28a745; }
    .sync-indicator.error { background: #dc3545; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Remark input with save indicator */
    .remark-wrapper { position: relative; }
    .remark-saving {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.7rem;
      color: #666;
    }
  </style>
</head>
<body>
  <header class="header" id="header">
    <h1>
      <span id="eventName">Event Registration</span>
      <span class="category-badge" id="categoryBadge"></span>
    </h1>
    <p>Registration Dashboard ç™»è®°ä»ªè¡¨æ¿</p>
    <span class="status-badge" id="connectionStatus">
      <span class="sync-indicator synced"></span> Connected
    </span>
  </header>

  <main class="container">
    <!-- Category Selector -->
    <div class="category-selector" id="categorySelector">
      <button class="category-btn" onclick="selectCategory('science')">
        ğŸ”¬ Science & IT<br>ç†å·¥ç§‘
      </button>
      <button class="category-btn" onclick="selectCategory('business')">
        ğŸ’¼ Business & Art<br>å•†ç§‘
      </button>
    </div>

    <!-- Main Content -->
    <div id="mainContent" style="display: none;">
      <!-- Stats -->
      <section class="stats-grid">
        <!-- Top 3 Waiting -->
        <div class="top-courses-card">
          <h4>ğŸ”¥ Top 3 Waiting çƒ­é—¨ç­‰å€™</h4>
          <div id="topCoursesContent">
            <div class="no-waiting">No one waiting</div>
          </div>
        </div>
        
        <!-- Waiting Count -->
        <div class="stat-card waiting">
          <div class="stat-number" id="waitingCount">0</div>
          <div class="stat-label">Waiting ç­‰å€™</div>
        </div>
        
        <!-- Inside Count -->
        <div class="stat-card inside">
          <div class="stat-number" id="insideCount">0</div>
          <div class="stat-label">Inside é‡Œé¢</div>
        </div>
        
        <!-- Longest Wait -->
        <div class="longest-wait-card">
          <h4>â° Longest Wait æœ€ä¹…ç­‰å€™</h4>
          <div id="longestWaitContent">
            <div class="no-long-wait">âœ“ All good</div>
          </div>
        </div>
      </section>

      <!-- QR Code -->
      <section class="card qr-section">
        <h3>ğŸ“± <span id="qrTitle">Scan to Register</span></h3>
        <div class="qr-content">
          <div class="qr-box">
            <img id="qrCodeImage" src="" alt="QR Code">
          </div>
          <div class="qr-info">
            <p><strong>Registration URL:</strong></p>
            <code id="registrationUrl"></code>
            <div class="qr-actions">
              <button class="btn btn-outline" onclick="copyUrl()">ğŸ“‹ Copy</button>
              <button class="btn btn-outline" onclick="printQR()">ğŸ–¨ï¸ Print</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Table -->
      <section class="card table-section">
        <div class="table-header">
          <div class="filter-wrapper">
            <select id="filterSelect" class="filter-select" onchange="applyFilter()">
              <option value="">All Programmes æ‰€æœ‰è¯¾ç¨‹</option>
            </select>
          </div>
          <div class="table-actions">
            <button class="btn" onclick="switchCategory()">ğŸ”„ Switch</button>
            <button class="btn" onclick="refreshData()">ğŸ”„ Refresh</button>
            <a href="/admin.html" class="btn">âš™ï¸ Admin</a>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Time æ—¶é—´</th>
                <th>Name å§“å</th>
                <th>Phone ç”µè¯</th>
                <th>Programme è¯¾ç¨‹</th>
                <th>Status çŠ¶æ€</th>
                <th>Remark å¤‡æ³¨</th>
                <th>Time In</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>

        <div id="emptyState" class="empty-state">
          <span class="empty-icon">ğŸ“‹</span>
          <p>No registrations yet<br>æš‚æ— ç™»è®°</p>
        </div>

        <div id="loadingState" class="loading-state">
          <div class="spinner"></div>
        </div>
      </section>
    </div>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>
